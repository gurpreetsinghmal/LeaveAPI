<!DOCTYPE html>
<html>

<head>
    <title>Google Sheet DataTable</title>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>

    <style>
        body {
            font-family: Arial;
            padding: 20px;
        }
    </style>
</head>

<body>

    <h2>Leave Reports</h2>

    <table id="sheetTable" class="display" width="100%"></table>
<script>
    $(document).ready(function () {

        var sheetID = "1X2TVrDAh43bxUR8y0XjwwCaEPcxfDoG-Rh_eiFJypRk";

        var url =
            "https://docs.google.com/spreadsheets/d/" +
            sheetID +
            "/gviz/tq?tqx=out:json&tq&gid=0";

        fetch(url)
            .then(res => res.text())
            .then(text => {
                var json = JSON.parse(text.substr(47).slice(0, -2));

                var rawCols = json.table.cols;
                var rawRows = json.table.rows.map(r => r.c);

                // REMOVE EMPTY COLUMNS
                let validColumnIndexes = [];

                rawCols.forEach((col, i) => {
                    let headerEmpty = !col.label || col.label.trim() === "";

                    // Check if entire column is empty
                    let columnEmpty = rawRows.every(r => !r[i] || r[i].v === "" || r[i].v === null);

                    if (!headerEmpty && !columnEmpty) {
                        validColumnIndexes.push(i);
                    }
                });

                // Clean columns
                var columns = validColumnIndexes.map(i => ({
                    title: rawCols[i].label
                }));

                // Clean rows
                var rows = rawRows.map(r =>
                    validColumnIndexes.map(i => (r[i] ? r[i].v : ""))
                );

                $("#sheetTable").DataTable({
                    data: rows,
                    columns: columns
                });
            })
            .catch(err => console.error("Error loading sheet:", err));

    });
</script>

   

</body>

</html>


