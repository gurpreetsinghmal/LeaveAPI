<!DOCTYPE html>
<html>
<head>
    <title>CORS-Free Google Sheet Table</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.4/tabletop.min.js"></script>
</head>

<body>
<h2>Google Sheet â†’ DataTable (No CORS, No Empty Columns)</h2>

<table id="sheetTable" class="display" width="100%"></table>

<script>
window.onload = function () {

    Tabletop.init({
        key: "1X2TVrDAh43bxUR8y0XjwwCaEPcxfDoG-Rh_eiFJypRk",
        simpleSheet: true,
        callback: function (data) {

            // Remove columns where all rows are empty
            let cleanKeys = Object.keys(data[0]).filter(key => {
                return data.some(row => row[key] && row[key].toString().trim() !== "");
            });

            // Build columns for DataTable
            let columns = cleanKeys.map(k => ({ title: k }));

            // Build row data only for clean columns
            let rows = data.map(row => cleanKeys.map(k => row[k] || ""));

            $("#sheetTable").DataTable({
                data: rows,
                columns: columns
            });
        }
    });

}
</script>

</body>
</html>
